# IP

- [IP](#ip)
  - [资料](#资料)
  - [整理](#整理)
    - [IP 首部](#ip-首部)
      - [IP 首部长度(THL)](#ip-首部长度thl)
      - [IP 数据报长度(Total Length)](#ip-数据报长度total-length)
      - [生存时间(TTL, Time To Live)](#生存时间ttl-time-to-live)
    - [子网](#子网)
      - [子网掩码](#子网掩码)

## 资料

[rfc791 - INTERNET PROTOCOL](https://tools.ietf.org/html/rfc791)

## 整理

### IP 首部

        0                   1                   2                   3
        0 1 2 3 4 5 6 7 8 9 0 1 2 3 4 5 6 7 8 9 0 1 2 3 4 5 6 7 8 9 0 1
       +-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+
       |Version|  IHL  |Type of Service|          Total Length         |
       +-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+
       |         Identification        |Flags|      Fragment Offset    |
       +-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+
       |  Time to Live |    Protocol   |         Header Checksum       |
       +-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+
       |                       Source Address                          |
       +-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+
       |                    Destination Address                        |
       +-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+
       |                    Options                    |    Padding    |
       +-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+

#### IP 首部长度(THL)

- 普通 20 字节

  不含选项字段

- 最大 60 字节

  因为首部长度(IHL)字段为 4 bit, 代表首部占用 32 bit 字的数量.

      ((1 << 4) - 1) * sizeof(int32_t) == 60

#### IP 数据报长度(Total Length)

- 最大 65535 字节

  因为 总长度(Total Length)字段为 16 bit

#### 生存时间(TTL, Time To Live)

- 指数据报可以经过的最多路由器数

- 由源主机设置(通常为 32 或 64)

- 每经过一个路由器, 值减 1

### 子网

- 不把 IP 地址看成由单纯的一个网络号和一个主机号组成, 而是把主机号再分成一个子网号和一个主机号

#### 子网掩码

- 32 bit的值

  - 其中值为 1 的比特留给网络号和子网号

  - 为 0 的比特留给主机号
